kind: Module
type: container
name: lbob
exclude: ["*.yml", "terraform/**", ".gardenignore"]
dockerfile: Dockerfile
services:
  - name: lbob
    annotations:
      dapr.io/enabled: "true"
      dapr.io/app-id: "app"
      dapr.io/app-port: "80"
    devMode:
      # Within the `app` module, you'll find the ASGI app, app = FastAPI(), in the `main.py` file.
      command: ["python", "-m", "little_bits_of_buddha_worldofgeese"]
      sync:
        - source: src/little_bits_of_buddha_worldofgeese
          target: /home/appuser/little_bits_of_buddha_worldofgeese
          # Target is always an exact mirror of source; any conflicts overridden by source
          mode: one-way-replica
          exclude: [__pycache__]
          defaultOwner: root # <- set an integer user ID or a string name
        - source: tests
          target: /home/appuser/tests
          mode: one-way-replica
          exclude: [__pycache__]
          defaultOwner: root # <- set an integer user ID or a string name
tests:
  - name: unit
    command:
      - pytest
      - tests
---
kind: Module
type: kubernetes
name: secret-reader-rbac
description: RBAC rules required for Dapr to read secrets from namespace
manifests:
  - apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: secret-reader
    rules:
      - apiGroups:
          - ""
        resources:
          - secrets
        verbs:
          - get
  - apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: dapr-secret-reader
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: secret-reader
    subjects:
      - kind: ServiceAccount
        name: default
